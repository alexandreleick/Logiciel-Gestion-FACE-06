{"version":3,"file":"calendar.service.js","sourceRoot":"","sources":["../../../../src/modules/datepicker/services/calendar.service.ts"],"names":[],"mappings":"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","sourcesContent":["import { EventEmitter } from \"@angular/core\";\r\nimport { IDatepickerLocaleValues } from \"../../../behaviors/localization/index\";\r\nimport { DateUtil } from \"../../../misc/util/index\";\r\nimport { CalendarViewType } from \"../views/calendar-view\";\r\nimport { CalendarConfig } from \"../classes/calendar-config\";\r\n\r\nexport enum CalendarMode {\r\n    DateOnly = 0,\r\n    TimeOnly = 1,\r\n    Both = 2\r\n}\r\n\r\nexport class CalendarService {\r\n    private _config:CalendarConfig;\r\n\r\n    public get config():CalendarConfig {\r\n        return this._config;\r\n    }\r\n\r\n    public set config(config:CalendarConfig) {\r\n        this._config = config;\r\n        config.updateBounds(this._selectedDate || this.currentDate);\r\n    }\r\n\r\n    public currentView:CalendarViewType;\r\n    public get inFinalView():boolean {\r\n        return this.currentView === this.config.mappings.finalView;\r\n    }\r\n\r\n    public currentDate:Date;\r\n    private _selectedDate?:Date;\r\n\r\n    public get selectedDate():Date | undefined {\r\n        return this._selectedDate;\r\n    }\r\n\r\n    public set selectedDate(date:Date | undefined) {\r\n        if (date) {\r\n            this._selectedDate = DateUtil.clone(date);\r\n            this.currentDate = DateUtil.clone(date);\r\n        } else {\r\n            this._selectedDate = undefined;\r\n        }\r\n\r\n        this.config.updateBounds(this._selectedDate || this.currentDate);\r\n        this.onManualUpdate();\r\n    }\r\n\r\n    private _minDate?:Date;\r\n    private _maxDate?:Date;\r\n\r\n    public get minDate():Date | undefined {\r\n        if (this._minDate && this.config.dateMinBound) {\r\n            return this._minDate > this.config.dateMinBound ? this._minDate : this.config.dateMinBound;\r\n        }\r\n        return this._minDate || this.config.dateMinBound;\r\n    }\r\n\r\n    public set minDate(min:Date | undefined) {\r\n        this._minDate = min;\r\n    }\r\n\r\n    public get maxDate():Date | undefined {\r\n        if (this._maxDate && this.config.dateMaxBound) {\r\n            return this._maxDate < this.config.dateMaxBound ? this._maxDate : this.config.dateMaxBound;\r\n        }\r\n        return this._maxDate || this.config.dateMaxBound;\r\n    }\r\n\r\n    public set maxDate(max:Date | undefined) {\r\n        this._maxDate = max;\r\n    }\r\n\r\n    private _firstDayOfWeek:number;\r\n\r\n    public get firstDayOfWeek():number {\r\n        return this._firstDayOfWeek;\r\n    }\r\n\r\n    public set firstDayOfWeek(firstDayOfWeek:number) {\r\n        if (firstDayOfWeek != undefined) {\r\n            this._firstDayOfWeek = Math.max(0, Math.min(6, firstDayOfWeek));\r\n        }\r\n    }\r\n\r\n    public onDateChange:EventEmitter<Date>;\r\n\r\n    constructor(config:CalendarConfig, public localeValues:IDatepickerLocaleValues) {\r\n        this.config = config;\r\n\r\n        this.currentDate = new Date();\r\n\r\n        this.firstDayOfWeek = this.localeValues.firstDayOfWeek;\r\n\r\n        this.onDateChange = new EventEmitter<Date>();\r\n\r\n        this.reset();\r\n    }\r\n\r\n    public onManualUpdate:() => void = () => {};\r\n\r\n    public reset():void {\r\n        this.currentView = this.config.mappings.finalView;\r\n\r\n        if (!this._selectedDate) {\r\n            let current = this.currentDate.getTime();\r\n            if (this._minDate) {\r\n                current = Math.max(current, this._minDate.getTime());\r\n            }\r\n            if (this._maxDate) {\r\n                current = Math.min(current, this._maxDate.getTime());\r\n            }\r\n\r\n            this.currentDate = new Date(current);\r\n            this.config.updateBounds(this.currentDate);\r\n\r\n            this.currentView = this.config.mappings.initialView;\r\n        }\r\n    }\r\n\r\n    public changeDate(date:Date, fromView:CalendarViewType):void {\r\n        this.currentDate = date;\r\n\r\n        if (fromView === this.config.mappings.finalView) {\r\n            this.selectedDate = date;\r\n\r\n            return this.onDateChange.emit(date);\r\n        }\r\n\r\n        this.updateView(this.config.mappings.changed, fromView);\r\n    }\r\n\r\n    public zoomOut(fromView:CalendarViewType):void {\r\n        this.updateView(this.config.mappings.zoom, fromView);\r\n    }\r\n\r\n    private updateView(mappings:Map<CalendarViewType, CalendarViewType>, fromView:CalendarViewType):void {\r\n        const mapping = mappings.get(fromView);\r\n        if (mapping == undefined) {\r\n            throw new Error(\"Unknown view type.\");\r\n        }\r\n        this.currentView = mapping;\r\n    }\r\n}\r\n"]}